---
import DefaultBody from "../layouts/DefaultBody.astro";
---

<DefaultBody 
  title="Donate"
  description="Support our work with a custom donation."
  author="Alex Toucan"
>
  <div class="container my-5" style="max-width: 600px;">
    <h1 class="mb-4 text-center">Make a Donation</h1>

    <div class="mb-3">
      <label for="donation-amount" class="form-label">Donation Amount (USD)</label>
      <input 
        type="number" 
        class="form-control" 
        id="donation-amount" 
        min="1" 
        placeholder="Enter amount (e.g., 25)"
      />
    </div>

    <button id="donate-btn" class="btn btn-primary w-100">
      Donate
    </button>

    <p class="text-muted mt-3 text-center">
      Payments are processed securely through Stripe.
    </p>
  </div>

  <script type="module">
    const btn = document.getElementById("donate-btn");

    btn.addEventListener("click", async () => {
      const input = document.getElementById("donation-amount");
      const amount = Number(input.value);

      if (!amount || amount < 1) {
        alert("Please enter a valid donation amount.");
        return;
      }

      // Convert dollars â†’ cents
      const amountInCents = Math.round(amount * 100);

      const res = await fetch("/api/create-checkout-session", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          items: [
            {
              id: "donation",
              amount: amountInCents
            }
          ]
        })
      });

      const data = await res.json();
      if (data.url) {
        window.location = data.url;
      } else {
        alert("Checkout failed: " + data.error);
      }
    });
  </script>
</DefaultBody>
